version: 2
jobs:
  build:

    macos:
      xcode: "9.3.0"

    steps:
      - checkout

      - run:
          name: pre-start simulator
          command: >
            xcrun instruments -w "iPhone 6 (10.3.1) [" || true
            xcrun instruments -w "iPhone 7 (11.3) [" || true

      - run:
          name: Install ruby dependencies
          command: bundle install

      - run:
          name: Run tests
          command: make test

      - run:
          name: Build sample app
          command: make build

      - run:
          name: Integrate using CocoaPods
          command: make integrate_cocoapods
